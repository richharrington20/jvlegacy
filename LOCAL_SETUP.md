# Local Development Server Setup Guide

This guide will help you set up the Laravel application on your local machine.

## Prerequisites

Before starting, ensure you have the following installed:

- **PHP 8.2+** with required extensions:
  - pdo_mysql
  - mbstring
  - xml
  - curl
  - zip
  - gd
- **Composer** (PHP package manager)
- **Node.js 18+** and **npm**
- **MySQL** or **MariaDB** (for the legacy database connection)

## Quick Setup

### Option 1: Automated Setup Script

Run the setup script:

```bash
./setup-local.sh
```

### Option 2: Manual Setup

Follow these steps manually:

#### 1. Create Environment File

```bash
cp .env.example .env
```

#### 2. Install PHP Dependencies

```bash
composer install
```

#### 3. Generate Application Key

```bash
php artisan key:generate
```

#### 4. Install Node Dependencies

```bash
npm install
```

#### 5. Configure Database

Edit `.env` file and set your legacy database credentials:

```env
DB_LEGACY_HOST=127.0.0.1
DB_LEGACY_PORT=3306
DB_LEGACY_DATABASE=your_database_name
DB_LEGACY_USERNAME=your_username
DB_LEGACY_PASSWORD=your_password
```

**Note:** This application uses a `legacy` database connection to connect to an existing MySQL database. Make sure your database is accessible and contains the required tables.

#### 6. Create Storage Link

```bash
php artisan storage:link
```

#### 7. Clear Caches

```bash
php artisan config:clear
php artisan cache:clear
php artisan view:clear
php artisan route:clear
```

## Running the Development Server

### Option 1: Simple Server (PHP only)

```bash
php artisan serve
```

This will start the server at `http://localhost:8000`

### Option 2: Full Development Environment

The project includes a convenient dev script that runs everything:

```bash
composer run dev
```

This command runs:
- Laravel development server (port 8000)
- Queue worker
- Log viewer (Pail)
- Vite dev server (for frontend assets)

### Option 3: Separate Terminals

If you prefer to run services separately:

**Terminal 1 - Laravel Server:**
```bash
php artisan serve
```

**Terminal 2 - Vite (Frontend Assets):**
```bash
npm run dev
```

**Terminal 3 - Queue Worker (if using queues):**
```bash
php artisan queue:work
```

## Database Setup

### Existing Database

This application connects to a legacy database. Ensure:

1. Your MySQL/MariaDB server is running
2. The database exists and is accessible
3. The credentials in `.env` are correct
4. The database contains the required tables

### Running Migrations

If you need to run migrations for new tables:

```bash
php artisan migrate
```

**Note:** Some migrations may reference the `legacy` connection. Check migration files to see which connection they use.

## Environment Configuration

Key environment variables in `.env`:

```env
APP_NAME="JaeVee Legacy"
APP_ENV=local
APP_KEY=base64:... (generated by key:generate)
APP_DEBUG=true
APP_URL=http://localhost:8000

# Legacy Database Connection
DB_LEGACY_HOST=127.0.0.1
DB_LEGACY_PORT=3306
DB_LEGACY_DATABASE=your_database
DB_LEGACY_USERNAME=your_username
DB_LEGACY_PASSWORD=your_password

# Mail Configuration (for Postmark)
MAIL_MAILER=postmark
POSTMARK_TOKEN=your_postmark_token

# Session & Cache
SESSION_DRIVER=file
CACHE_DRIVER=file
QUEUE_CONNECTION=sync
```

## Troubleshooting

### Composer Issues

If you encounter Composer errors:

```bash
composer clear-cache
composer install --no-interaction
```

### Permission Issues

Ensure storage and cache directories are writable:

```bash
chmod -R 775 storage bootstrap/cache
```

### Database Connection Errors

1. Verify MySQL/MariaDB is running
2. Check database credentials in `.env`
3. Test connection:
   ```bash
   php artisan tinker
   >>> DB::connection('legacy')->getPdo();
   ```

### Vite Issues

If assets aren't loading:

1. Make sure Vite is running: `npm run dev`
2. Check browser console for errors
3. Clear browser cache
4. Rebuild assets: `npm run build`

### Port Already in Use

If port 8000 is already in use:

```bash
php artisan serve --port=8001
```

## Accessing the Application

Once the server is running:

- **Application:** http://localhost:8000
- **Investor Login:** http://localhost:8000/investor/login
- **Admin Panel:** http://localhost:8000/admin (requires authentication)

## Development Workflow

1. Make code changes
2. Vite will automatically rebuild assets (if `npm run dev` is running)
3. Clear caches if needed: `php artisan config:clear`
4. Refresh browser to see changes

## Additional Commands

### Clear All Caches
```bash
php artisan optimize:clear
```

### View Routes
```bash
php artisan route:list
```

### Run Tests
```bash
composer test
```

### Code Formatting
```bash
./vendor/bin/pint
```

## Need Help?

If you encounter issues:

1. Check Laravel logs: `storage/logs/laravel.log`
2. Enable debug mode in `.env`: `APP_DEBUG=true`
3. Check PHP error logs
4. Verify all prerequisites are installed correctly


